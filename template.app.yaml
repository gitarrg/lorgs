# Config for Google App Engine


# >>> gcloud app deploy --project lorrgs -q
# >>> gcloud app deploy --project lorrgs -q --no-promote

service: default
runtime: python39

default_expiration: "7d"  # static files cache

automatic_scaling:
  max_instances: 4


entrypoint: >
  gunicorn
  --bind :$PORT
  --workers 2
  --log-level warning
  --worker-class uvicorn.workers.UvicornWorker
  "lorgs.app:create_app"


env_variables:

  # Lorgs Config
  LORGS_CONFIG_NAME: lorgs.config.ProductionConfig
  SECRET_KEY: {{SECRET_KEY}}

  # Third Party Credentials
  WCL_CLIENT_ID: {{WCL_CLIENT_ID}}
  WCL_CLIENT_SECRET: {{WCL_CLIENT_SECRET}}

  DISCORD_CLIENT_ID: {{DISCORD_CLIENT_ID}}
  DISCORD_CLIENT_SECRET: {{DISCORD_CLIENT_SECRET}}
  DISCORD_BOT_TOKEN: {{DISCORD_BOT_TOKEN}}
  REDIRECT_URI: {{REDIRECT_URI}}

  # Database Credentials
  MONGO_URI: {{MONGO_URI}}


handlers:

  # TODO: re-enable?
  # serve robots.txt
  # - url: /robots.txt
  #   static_files: static/robots.txt
  #   upload: static/robots.txt

  # all API-Requests go to the flask backend
  - url: /.*
    script: auto
