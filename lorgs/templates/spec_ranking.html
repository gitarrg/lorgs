
{% macro header_boss(boss, spec) -%}
<h1 class="m-0">
    <a href="https://www.warcraftlogs.com/zone/rankings/{{boss.zone.id}}#boss={{boss.id}}&class={{spec.wow_class.name_slug_cap}}&spec={{spec.name_slug_cap}}&metric={{spec.role.metric}}" target="_blank">
        <span class="wow-class-{{spec.wow_class.name_slug}}">{{spec.full_name}}s</span>
        <span>vs.</span>
        <span>{{boss.name}}</span>
    </a>
</h1>
{%- endmacro %}


{##############################################################################}

{% extends "base.html" %}

{% block head %}{% endblock %}


{##############################################################################}
{# TITLE #}

{%- block title %}
Lorgs: {{spec.full_name}} vs. {{boss.name}}
{%- endblock -%}


{##############################################################################}
{# HEADER #}

{% block header -%}
<div class="mt-3 flex-row d-flex flex-wrap-reverse">
    <div class="mb-2">
    {{ header_boss(boss, spec) }}
    </div>

    <div class="ml-auto mb-2">
        {% include "elements/spec_ranking_nav.html" %}
    </div>
</div>
{% endblock %}


{##############################################################################}
{# CONTENT #}

{% block content -%}
<div class="mb-2">
    {% include "elements/settings_bar.html" %}
</div>


<!-- TIMELINES -->
<div class="p-2 bg-dark rounded border d-flex">

    <!-- Player Names -->
    <div id="player_names_container" class="player_names_container spec_ranking">
        <div class="timeline_ruler_playerholder"></div>
    </div>

    <div id="player_timelines_container" class="flex-grow-1">

        {# loading bar #}
        <div id="canvas_loading" class="position-absolute top-50 start-50">
            <span class="h1">loading...</span>
            <div id="task_progress_bar_bg" class="bg-dark">
                <div id="task_progress_bar_fg" class="bg-info no-transition"></div>
            </div>
        </div>

        <!-- the canvas -->
        <div id="timeline_canvas" style="overflow: hidden;"></div>
    </div>

    <div class="clearfix"></div>

</div>


{% endblock %}

{% block scripts %}
{{ super() }}

{# todo: use sync src #}
<script src="https://unpkg.com/konva@8/konva.min.js"></script>
{% if config.LOCAL_FILES %}
    {# find a better way to do this #}
    <script src="{{url_for('static', filename='timeline_modules/main.js')}}"></script>
    <script src="{{url_for('static', filename='timeline_modules/spell.js')}}"></script>
    <script src="{{url_for('static', filename='timeline_modules/cast.js')}}"></script>
    <script src="{{url_for('static', filename='timeline_modules/player.js')}}"></script>
    <script src="{{url_for('static', filename='timeline_modules/fight.js')}}"></script>
    <script src="{{url_for('static', filename='timeline_modules/scene.js')}}"></script>
    <script src="{{url_for('static', filename='timeline_modules/ruler.js')}}"></script>
    <script src="{{url_for('static', filename='timeline_modules/stage.js')}}"></script>
{% else %}
    <script src="{{url_for('static',filename='_generated/all_min_' + config.BUILD_TAG + '.js')}}"></script>
{% endif %}


<script type="text/javascript">

////////////////////////////////////////////////////////////////////////////////
// progress bar
//
const TASK_STATUS_BAR = document.getElementById("task_progress_bar_fg");
var PROGRESS_BAR_STATUS = 0;
function update_progress_bar() {
    PROGRESS_BAR_STATUS += 10;

    TASK_STATUS_BAR.style.width = PROGRESS_BAR_STATUS + "%";

    // update again in 100ms
    if (PROGRESS_BAR_STATUS < 100) {
        setTimeout(update_progress_bar, 200)
    }
}


////////////////////////////////////////////////////////////////////////////////


async function init() {

    update_progress_bar()

    // create scene
    let scene = new Scene({

        // settings
        spec_slug: "{{spec.full_name_slug}}",
        boss_slug: "{{boss.name_slug}}",

        // hmtl elements
        canvas: document.getElementById("timeline_canvas"),
        player_names_container: document.getElementById("player_names_container"),
        spell_settings_bar: document.getElementById("settings_bar"),
    })
    await scene.load()

    // hide loading text
    let canvas_loading = document.getElementById("canvas_loading");
    hide(canvas_loading)
}

// init()
document.addEventListener('DOMContentLoaded', init)

</script>
{% endblock %}


